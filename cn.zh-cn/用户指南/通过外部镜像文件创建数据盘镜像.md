# 通过外部镜像文件创建数据盘镜像<a name="ims_01_0215"></a>

## 操作场景<a name="section167191841145711"></a>

数据盘镜像是只包含用户业务数据的镜像。用户可以通过外部镜像文件创建数据盘镜像。

数据盘镜像可以用于创建云硬盘，将用户的业务数据迁移到云上。

## 约束与限制<a name="section438627819352"></a>

-   数据盘镜像必须明确指定操作系统类型，只能是Windows或Linux。
-   云硬盘容量大小范围为40-2048GB。
-   上传外部镜像文件到OBS桶时，OBS桶和镜像文件的存储类别必须是OBS标准存储。

## 前提条件<a name="section5577833119352"></a>

数据盘的镜像文件已经上传到OBS个人桶。

当前云平台支持导入vhd、vmdk、qcow2、raw、vhdx、qcow、vdi、qed、zvhd或zvhd2等格式镜像文件。推荐使用qcow2格式的镜像文件。如果您需要导入其他格式的镜像，请先使用qemu-img工具转换镜像的格式后再导入。导入的镜像文件必须为单一的镜像文件，例如pre-allocated格式镜像依赖2个文件：“xxxx.vmdk”和“xxxx-flat.vmdk”，这两种格式的镜像文件不能直接导入到云平台，需提前转换成通用的vmdk或qcow2格式才能导入。

镜像格式转换请参考“[转换镜像格式](https://support.huaweicloud.com/bestpractice-ims/ims_bp_0030.html)”。

## 操作步骤<a name="section17888236123013"></a>

1.  登录管理控制台。
2.  选择“计算 \> 镜像服务”。

    进入镜像服务页面。

3.  单击右上角的“创建私有镜像”。
4.  在“镜像类型和来源”页面，选择镜像的创建方式为“数据盘镜像”。
5.  镜像源选择“镜像文件”，从列表中先选择保存镜像文件的桶，再选择对应的镜像文件。如[图1](#fig5234441171414)所示。

    **图 1**  通过外部镜像文件创建数据盘镜像<a name="fig5234441171414"></a>  
    ![](figures/通过外部镜像文件创建数据盘镜像.png "通过外部镜像文件创建数据盘镜像")

6.  如需使用快速通道方式注册镜像文件，请勾选“开启快速通道”。

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >-   由于当前快速导入功能仅支持zvhd2或raw格式的镜像文件，因此仅在上传zvhd2或raw格式的镜像文件时出现此选项。  
    >-   镜像文件格式转换、生成位表文件等操作请参考[快速导入镜像文件](快速导入镜像文件.md)章节。  

    勾选后系统会提示您确认镜像文件是否已完成镜像文件准备。

    -   zvhd2格式镜像文件：确认镜像文件已经转换为zvhd2格式。
    -   raw格式镜像文件：确认镜像文件已经转换为raw格式，并上传位表文件。

    如果当前已完成镜像文件准备，请勾选“镜像文件准备”。

7.  在配置信息页面，选择操作系统类型。
8.  输入数据盘的大小，请确保输入的大小不小于镜像文件的数据盘大小。
9.  输入镜像名称，并根据需要输入镜像的描述。
10. （可选）加密镜像，如果需要加密镜像，请勾选“KMS加密”并从密钥列表中选择需要使用的密钥名称。

    用户使用OBS桶中已上传的外部镜像文件创建数据盘镜像的过程中，可以在注册镜像时选择KMS加密及密钥完成镜像加密。

11. 单击“立即创建”。
12. 根据界面提示，确认镜像参数。阅读并勾选协议，单击“提交申请”。

## 后续操作<a name="section14131852173714"></a>

数据盘镜像创建成功后，您可能需要创建新的数据盘并挂载到目标云服务器上，有两种方法供您参考：

-   在创建好的数据盘镜像所在行，单击“申请数据盘”创建新的数据盘（支持批量创建），然后挂载至目标云服务器。
-   在创建弹性云服务器向导页面，为云服务器添加数据盘时，单击“用数据盘镜像创建磁盘”，然后选择一个数据盘镜像。

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >每个数据盘镜像只可以用来创建一个数据盘，不能重复选择。例如，[图2](#fig974917131918)中，为云服务器添加了一块数据盘，这个数据盘来源是数据盘镜像data\_disk\_image，如果想再添加一块数据盘，则不能使用数据盘镜像data\_disk\_image来创建。  

    **图 2**  添加数据盘<a name="fig974917131918"></a>  
    ![](figures/添加数据盘.png "添加数据盘")


