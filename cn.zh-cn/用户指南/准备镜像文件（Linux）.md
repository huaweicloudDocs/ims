# 准备镜像文件（Linux）<a name="ims_01_0209"></a>

您需要提前准备好符合条件的镜像文件，并了解操作系统的已知问题（参见[已知问题](已知问题.md)）。

>![](public_sys-resources/icon-note.gif) **说明：** 
>-   [表1](#table85212269215)中，文件系统、网络、驱动相关的配置需要在虚拟机内部完成，强烈建议您在原平台的虚拟机实施修改后，再导出镜像文件。当然，您也可以使用弹性云服务器完成这些配置，具体操作请参见“[Linux外部镜像文件在导出前未完成初始化配置，怎么办？](https://support.huaweicloud.com/ims_faq/ims_faq_0012.html)”。
>-   大文件导入（不超过1TB）目前仅支持RAW和ZVHD2格式，RAW镜像文件除了要满足[表1](#table85212269215)的要求外，还需要生成位表文件，同镜像文件一并上传。详细操作请参见[快速导入镜像文件](快速导入镜像文件.md)。

**表 1**  Linux操作系统的镜像文件限制

|镜像文件属性|条件|
|--|--|
|操作系统|SUSE、Oracle Linux、Red Hat、Ubuntu、openSUSE、CentOS、Debian、Fedora、EulerOS、中标麒麟支持32位和64位操作系统不能与特定的硬件绑定操作系统必须支持全虚拟化所支持的操作系统版本请参考“外部镜像文件支持的格式和操作系统类型”，在此范围内的操作系统支持后台自动化配置（详情请参阅“通过镜像文件注册私有镜像过程中，系统会对镜像做哪些修改？”），在此之外的操作系统请您自行排查及安装virtio驱动（详见安装原生的KVM驱动），在注册镜像页面选择Other Linux，导入后系统启动情况取决于驱动完备度。|
|镜像格式|VMDK、VHD、QCOW2、RAW、VHDX、QED、VDI、QCOW、ZVHD2和ZVHD|
|镜像大小|镜像大小不超过128GB。如果镜像大小介于128GB和1TB之间，需要将镜像文件转换为RAW或ZVHD2格式，然后使用快速导入功能进行导入。参考“通过qemu-img-hw工具转换镜像格式”转换镜像格式。参考“快速导入镜像文件”了解快速导入功能。|
|网络能力|**必选项，不设置会导致启动异常或网络能力异常，包括：**清理网络规则文件设置网卡属性为DHCP**可选项，即增值能力，主要包括：**开启网卡多队列开启网卡多队列功能可以将网卡中断分散给不同的CPU处理，实现负载均衡，从而提升网络PPS和带宽性能。操作方法请参考“如何设置镜像的网卡多队列属性”。配置动态获取IPv6地址IPv6的使用，可以有效弥补IPv4网络地址资源有限的问题。镜像中配置动态获取IPv6地址，发放的云服务器能够同时支持IPv4和IPv6地址。配置方法请参考“如何开启云服务器动态获取IPv6”。|
|工具|强烈建议安装Cloud-Init工具。Cloud-Init是开源的云初始化工具，使用安装了Cloud-Init的镜像创建云服务器时可以通过“用户数据注入”功能，注入初始化自定义信息（例如为云服务器设置登录密码）；还可以通过查询、使用元数据，对正在运行的云服务器进行配置和管理。不安装Cloud-Init工具，将无法对云服务器进行自定义配置，只能使用镜像原有密码登录云服务器。安装方法请参考安装Cloud-Init工具。|
|驱动|安装原生的KVM驱动|
|文件系统|修改grub文件磁盘标识方式为UUID修改fstab文件磁盘标识方式为UUID|
|其他限制|暂不支持创建带有数据盘的镜像，镜像文件中必须只能包含系统盘，且系统盘大小范围为：[40GB, 1024GB]镜像文件的初始密码至少包含以下4种字符：大写字母、小写字母、数字、特殊字符（!@$%^-_=+[{}]:,./?）镜像启动分区和系统分区必须包含在同一个磁盘中支持的镜像引导方式：x86架构部分操作系统镜像支持UEFI启动方式（查看支持UEFI启动方式的操作系统）。ARM架构操作系统镜像仅支持UEFI启动方式。镜像文件必须为非加密，否则可能导致镜像注册后创建的云服务器无法正常使用。“/etc/fstab”文件中不能包含非系统盘的自动挂载信息，否则创建的云服务器可能无法正常登录。如果外部镜像文件的系统盘为LVM设备，通过该镜像文件注册的私有镜像用来创建云服务器时，不支持文件注入。外部镜像文件所在虚拟机如果经历了关机过程，则必须是优雅关机，否则使用私有镜像创建的云服务器在启动时可能会出现蓝屏。VMDK格式的镜像文件必须是从VMWare Tools中导出后的虚拟机生成的文件，否则可能会因镜像解析问题导致系统无法正常启动。|


